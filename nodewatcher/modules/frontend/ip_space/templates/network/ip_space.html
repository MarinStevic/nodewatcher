{% extends "base.html" %}

{% contextblock %}
    {% load i18n sekizai_tags html_tags url_tags partial_tags leaflet_tags %}

    {% add_data "css_data" "css/ipspace.css" %}
    {% add_data "js_data" "js/d3.v4.js" %}
    {% add_data "js_data" "js/point.js" %}
    {% add_data "js_data" "js/hilbert2d.js" %}
    {% add_data "js_data_end" "js/jquery.tipsy.js" %}
    {% add_data "js_data_end" "js/DrawCidrs.js" %}


    {% trans "Ip space" as title %}
{% endcontextblock %}

{% block content %}
    <div class="row">
        <div class="col-md-2">
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Zoom to subnet<span class="caret"></span></button>
                <ul class="dropdown-menu" id="topnodes">
                    <li id="cidr"><a href="#" value="10.0.0.0/8">Loading data</option>
                </ul>
            </div>
        </div>
        <div class="col-md-8">
            <svg id="ipspace" class="silky-smooth"></svg>
        </div>
    </div>
    <script>
    $(document).ready(function(){
        var svgContainer = d3.select("#ipspace");
        var size = svgContainer.node().getBoundingClientRect().width;
        svgContainer.style("height", size + 'px');
        var main_subnet = "10.0.0.0/8";

        var cidr = new DrawCidr(svgContainer, size, main_subnet);
        cidr.load();

        $("#cidr").click(function(){
            alert(this.value);
            var scale= size/cidr.subnetSize(this.value);
            var start = cidr.subnetXY(this.value);
            console.log(start);
            svgContainer.selectAll("rect").attr('transform', 'translate(' + start[0]*-1*scale + ',' + start[1]*-1*scale + ') scale(' + scale + ')');
        });
    });
    </script>
{% endblock %}
